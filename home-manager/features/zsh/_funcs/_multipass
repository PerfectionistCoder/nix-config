#compdef multipass

_multipass() {
  local state cur

  _arguments -C \
    '1:store:->stores' \
    '*:args:->args'

  case $state in
    stores)
      local -a stores
      for d in $PASSWORD_STORE_DIR/*/; do
        name=$(expr "${d/%\/}" : '.*\(/.*\)')
        stores+=("${name/\/}")
      done
      _describe 'stores' stores
      ;;
    args)
      (( CURRENT-- )) 
      _pass
      ;;
  esac
}

